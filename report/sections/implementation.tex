The Multi-file Code Coverage Tool is implemented as a PLaneT package. This requires no modification to any of DrRacket's source files and satisfies one of the additional goals for the project. PlaneT also brings the benefits of easy distribution, installation, updating, and feedback for the tool. The Multi-file Code Coverage Tool works in the following steps: first, searching for a test info hash table; second, coloring the code of currently open files; and third, displaying a series of dialogs that give the user test coverage information. This process can be seen in figure \ref{fig:extended-flow} on page \pageref{fig:extended-flow}.

The Multi-file Code Coverage Tool adds a new button to DrRacket, labeled ``Multi-file Coverage'' (Figure \ref{fig:coverage-button}). Clicking this button will color code in all open tabs using the currently in focus tab's test coverage info hash table. This means, if the user opens their test program and runs it and then clicks the button, all open tabs will be colored relative to the test file. However, if the user switches to another file, before clicking the ``Multi-file Coverage'' button, the newly switched to file's test coverage info will be applied. This behavior, while perhaps not immediately obvious, allows for code coverage information and highlighting to be quickly switched between.

\newfigure{coverage-button}{Multi-File Coverage Button in DrRacket}{width=9cm}{h!}

\newfigure{extended-flow}{Extended DrRacket Code Coverage Flow}{width=10cm}{h!}

After the ``Multi-file Coverage'' button is pressed the first thing done is loading the test coverage info hash table. This hash table contains all the information needed to properly display code coverage. There are two places that the test coverage info hash table may be found: in the current \emph{tab's} memory or as a saved coverage info file. If it is found in memory that means the program was recently run and the hash table is as up to date as it possibly can be. For this reason loading the hash table from memory is preferred. However, if the test coverage info could not be found in memory then it is looked for on the disk. The saved hash table is placed in a ``compiled'' directory next to the source file. This ``compiled'' directory is also where DrRacket would place a compiled versions of the source program. Every program only has one saved coverage file. It's file name is the same of the source file, but with a special coverage extension. When the test coverage info is loaded from a saved file it may be out of date. So, the save file's last modification date is compared to that of the source file's. If the save file was modified more recently than the source file a warning, as seen in figure \ref{fig:out-of-date-dialog}, is displayed. The user may choose to ignore this warning. While doing so means that code coverage will used outdated information, it allows the user to load code coverage information without running the source file again. This could be useful if the source file is large and takes a long time to run. If the test coverage information could not be found, either in memory or in a save file, an error message is displayed, as seen in figure \ref{fig:no-coverage-found-dialog}. Finally, if the test coverage info was loaded from memory, then the data is written to the coverage save file.

\newfigure{out-of-date-dialog}{Out Of Date Dialog}{width=8.5cm}{h!} 
\newfigure{no-coverage-found-dialog}{No Coverage Found Dialog}{width=8.5cm}{h!}


Next the loaded code coverage information is sent to open files that were covered by the source file to do code coloring. Each code expression in the test info coverage hash table has a file name attached to it. So, by searching through the coverage information a list of covered files can be computed. The coverage info is then applied to every open file. A list of open files are found by looking through every \emph{tab}, in every \emph{frame} found in the \emph{frame group}. Then, for each open file, that is also covered by the source file, the test coverage info is sent to it. No reduction of the test coverage has table is needed before applying it to a file, even though it will contain irrelevant coverage information. The \emph{show-test-coverage-annotations} method in \emph{tab} will only use the relevant information. During the process of sending coverage information to tabs, it is also computed if the coverage is valid. Coverage information can become invalid when the file being receiving it has been modified after the coverage information was collected. The test coverage info hash table has no internal way of determining it's validity. So, before it is sent a check is preformed by comparing the last modification date of the saved coverage file and the source file. If the source file has been modified after the source file then its test coverage is considered invalid and no code coloring will be done to it. This information will also appear as an asterisk in the Covered Files Dialog (Figure \ref{fig:covered-files-dialog}). As mentioned in section \ref{background}, background, only uncompiled files are included in the test coverage info hash table. However, this provides more benefits the drawbacks. The largest benefit being that none of DrRacket's source files are included because they are all compiled.

\newfigure{covered-files-dialog}{Covered Files Dialog}{width=7cm}{h!}

The finial step of the Multi-file Code Coverage Tool is displaying a series of dialogs to inform the user on the collected coverage information. The first one displayed is the Covered Files Dialog (Figure \ref{fig:covered-files-dialog}). This displays a list of files that have been covered by the source file. Next to each file is that file's covered line percent. So, 100\% indicates that the entire file is covered. The files are sorted in acending order by covered percent. This is done because it is resonable that the user is more interested in files with uncovered code. The user may then select one, or more, files to switch too focus too, or open if needed, by clicking ``Open''. If the selected files were not already open, the code coveverage hash table is sent to them so that they may apply code coloring. Additionally, the user may selected the ``Open With Uncovered Lines Dialog'' indstead. This button will behavie like the ``Open'' button with the addition of displaying another Uncovered Lines Dialog (Figure \ref{fig:uncovered-lines-dialog}). This displays a list of lines containig uncovered code in the file that was just opened. The list of uncovered lines allows the user to more quickly find lines of interest. Without it the user must visualy scan the entire file for sectons of code that have been colored red.

\newfigure{uncovered-lines-dialog}{Uncovered Lines Dialog}{width=5cm}{h!}